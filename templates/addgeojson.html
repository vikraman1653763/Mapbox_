<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON Uploader</title>
    <style>
        #colorPickerContainer {
            display: flex;
            align-items: center;
        }
        .colorBox {
            display:block;
            width: 60px;
            height: 60px;
            border: 1px solid #000;
            margin-right: 10px;
        }
        #opacitySlider {
            width: 150px;
        }
        #rgbaValue {
            margin-top: 10px;
        }
        .colorRound{
            display:inline-block;
            color:red;
            width:10px;
            height:10px;
            border: 1px solid #000;
            border-radius:20px;
        }
    </style>
</head>
<body>
    <h1>Upload GeoJSON File</h1>
    <form action="/upload" method="POST" enctype="multipart/form-data" onsubmit="combineColorWithOpacity()">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required><br><br>
        <input type="file" name="file" accept=".geojson" required><br><br>
        <label for="color">Color:</label>
        <div id="colorPickerContainer">
            <input type="color" id="colorInput" name="color" value="#000000">
        </div><br><br>
        <label for="opacity">Opacity:</label>
        <input type="range" id="opacitySlider" name="opacity" min="0" max="1" step="0.01" value="1"> <span id="opacityValue">1</span>
        <input type="hidden" id="combinedColor" name="combinedColor">
        <br/> <br/>
        <div id="colorPreview" class='colorBox'></div>
        <br/><br/>
        <input type="submit" value="Upload">
    </form>
    <h2>Uploaded Files</h2>
    <ul>
        {% for file in files %}
            <li>
                {{ file.name }} - {{ file.filename }}
                <span class="colorRound" style="background-color:{{ file.color }};"></span>
                <form action="/delete/{{ file.id }}" method="POST" style="display: inline;">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit">Delete</button>
                </form>
            </li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('shape') }}"><button>View GeoJSON on Map</button></a>
    <a href="{{ url_for('preview') }}"><button>Preview on Map</button></a>

    <script>
        const colorPreview = document.getElementById('colorPreview');
        const colorInput = document.getElementById('colorInput');
        const opacitySlider = document.getElementById('opacitySlider');
        const combinedColorInput = document.getElementById('combinedColor');
        const opacityValue = document.getElementById('opacityValue');

        function combineColorWithOpacity() {
            const color = colorInput.value;
            const opacity = opacitySlider.value;
            const rgba = `rgba(${hexToRgb(color)}, ${opacity})`;
            combinedColorInput.value = rgba;
            colorPreview.style.backgroundColor = rgba;
            console.log(colorPreview.style.backgroundColor);

        }

        function hexToRgb(hex) {
            // Remove '#' from hex
            hex = hex.replace('#', '');

            // Convert hex to RGB
            const bigint = parseInt(hex, 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;

            return `${r}, ${g}, ${b}`;
        }
        colorInput.addEventListener('input', combineColorWithOpacity);
        opacitySlider.addEventListener('input', function() {
        opacityValue.textContent = this.value;
        combineColorWithOpacity();
        });

    </script>
</body>
</html>
